<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Functions for Shiny app development • InteractiveComplexHeatmap</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Functions for Shiny app development">
<meta property="og:description" content="InteractiveComplexHeatmap">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">InteractiveComplexHeatmap</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.99.15</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/InteractiveComplexHeatmap.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/decoration.html">Decorations on heatmaps</a>
    </li>
    <li>
      <a href="../articles/deseq2_app.html">A Shiny app for visualizing DESeq2 results</a>
    </li>
    <li>
      <a href="../articles/from_scratch.html">Implement interactive heatmap from scratch</a>
    </li>
    <li>
      <a href="../articles/implementation.html">How interactive complex heatmap is implemented</a>
    </li>
    <li>
      <a href="../articles/interactivate_indirect.html">Interactivate heatmaps indirectly generated by pheatmap(), heatmap.2() and heatmap()</a>
    </li>
    <li>
      <a href="../articles/shiny_dev.html">Functions for Shiny app development</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jokergoo/InteractiveComplexHeatmap/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="shiny_dev_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Functions for Shiny app development</h1>
                        <h4 class="author">Zuguang Gu ( <a href="mailto:z.gu@dkfz.de" class="email">z.gu@dkfz.de</a> )</h4>
            
            <h4 class="date">2021-05-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jokergoo/InteractiveComplexHeatmap/blob/master/vignettes/shiny_dev.Rmd"><code>vignettes/shiny_dev.Rmd</code></a></small>
      <div class="hidden name"><code>shiny_dev.Rmd</code></div>

    </div>

    
    
<style>
p {
    margin: 1em 0;
}
img {
    background-color: #FFFFFF;
    padding: 2px;
    border: 1px solid #DDDDDD;
    border-radius: 3px;
    border: 1px solid #CCCCCC;
    margin: 0 5px;
}
</style>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p><code><a href="../reference/htShiny.html">htShiny()</a></code> can export heatmaps as a stand-alone Shiny app. <strong>InteractiveComplexHeatmap</strong> also provides two functions for integrating the interactive heatmap widgets into other Shiny apps. The two functions are:</p>
<ul>
<li>
<code><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput()</a></code>: for building UI on the client side.</li>
<li>
<code><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap()</a></code>: for processing on the sever side.</li>
</ul>
<div id="with-one-interactive-heatmap-widget" class="section level3">
<h3 class="hasAnchor">
<a href="#with-one-interactive-heatmap-widget" class="anchor"></a>With one interactive heatmap widget</h3>
<p>The usage is simple. Following is an example that you can directly copy and paste to your R session.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/ComplexHeatmap">ComplexHeatmap</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/InteractiveComplexHeatmap">InteractiveComplexHeatmap</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">rand_mat</span><span class="op">)</span> <span class="co"># simply a random matrix</span>
<span class="va">ht1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">rand_mat</span>, name <span class="op">=</span> <span class="st">"mat"</span>,
    show_row_names <span class="op">=</span> <span class="cn">FALSE</span>, show_column_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">ht1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html">draw</a></span><span class="op">(</span><span class="va">ht1</span><span class="op">)</span>

<span class="va">ui</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">h3</a></span><span class="op">(</span><span class="st">"My first interactive ComplexHeatmap Shiny app"</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">p</a></span><span class="op">(</span><span class="st">"This is an interactive heatmap visualization on a random matrix."</span><span class="op">)</span>,
    <span class="fu"><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap</a></span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span>, <span class="va">ht1</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<script>
document.write('<img src="https://jokergoo.github.io/images/app_demo1.png" width="100%" />');
</script>
</div>
<div id="with-multiple-interactive-heatmap-widgets" class="section level3">
<h3 class="hasAnchor">
<a href="#with-multiple-interactive-heatmap-widgets" class="anchor"></a>With multiple interactive heatmap widgets</h3>
<p>You can also put multiple interactive heatmaps widgets in a single Shiny app, but this time you must assign a “<strong>heatmap ID</strong>” for each one, so that <code><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap()</a></code> can find the correct heatmap to respond. The heatmap ID should start with letters.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mat2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>
<span class="va">ht2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html">draw</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">mat2</span>, name <span class="op">=</span> <span class="st">"mat2"</span><span class="op">)</span><span class="op">)</span>

<span class="va">ui</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">h3</a></span><span class="op">(</span><span class="st">"The first heatmap"</span><span class="op">)</span>,
    <span class="fu"><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput</a></span><span class="op">(</span><span class="st">"heatmap_1"</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">h3</a></span><span class="op">(</span><span class="st">"The second heatmap"</span><span class="op">)</span>,
    <span class="fu"><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput</a></span><span class="op">(</span><span class="st">"heatmap_2"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">server</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap</a></span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span>, <span class="va">ht1</span>, <span class="st">"heatmap_1"</span><span class="op">)</span>
    <span class="fu"><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap</a></span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span>, <span class="va">ht2</span>, <span class="st">"heatmap_2"</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<script>
document.write('<img src="https://jokergoo.github.io/images/app_two.png" width=100% />');
</script><p>Similarly, multiple interactive heatmap widgets can be arranged by a list of tabs:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabsetPanel.html">tabsetPanel</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span><span class="st">"Numeric"</span>, <span class="fu"><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput</a></span><span class="op">(</span><span class="st">"heatmap_1"</span><span class="op">)</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span><span class="st">"character"</span>, <span class="fu"><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput</a></span><span class="op">(</span><span class="st">"heatmap_2"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">server</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap</a></span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span>, <span class="va">ht1</span>, <span class="st">"heatmap_1"</span><span class="op">)</span>
    <span class="fu"><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap</a></span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span>, <span class="va">ht2</span>, <span class="st">"heatmap_2"</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="customize-the-widgets" class="section level2">
<h2 class="hasAnchor">
<a href="#customize-the-widgets" class="anchor"></a>Customize the widgets</h2>
<p>There are three main components in the interactive heatmap UI, <em>i.e.</em>, the orignal heatmap, the sub-heatmap and an output that shows information of the clicked cell or the selected sub-heatmap. The original heatmap and sub-heatmap components can be resized by dragging the two boxes, but still, <code><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput()</a></code> provides arguments of <code>width1</code>, <code>width2</code>, <code>height1</code> and <code>height2</code> to control the initial sizes of the two components. They can be manually set to make sure the heatmap is well aligned, e.g. in <code><a href="../reference/htShinyExample.html">htShinyExample(2.2)</a></code>.</p>
<p>The initial style of the brush can be specified by <code>brush_opt</code> argument. The value should be a list and the value will be sent to <code><a href="https://rdrr.io/pkg/shiny/man/brushOpts.html">shiny::brushOpts()</a></code>. Note, the style of the brush can also be manually adjusted in the Shiny app.</p>
<div id="the-layout" class="section level3">
<h3 class="hasAnchor">
<a href="#the-layout" class="anchor"></a>The layout</h3>
<p>The layout of the three components are controlled by argument <code>layout</code>. It supports following values:</p>
<ul>
<li>
<code>"(1-2)|3"</code>: Original heatmap and sub-heatmap are in the same row, and output is in a second row. This is the default layout.</li>
<li>
<code>"1|(2-3)"</code>: Original heatmap is in a single row, while sub-heatmap and output are in a second row.</li>
<li>
<code>"1-2-3"</code>: All three components are in the same row.</li>
<li>
<code>"1|2|3"</code>: Each component is in a single row.</li>
<li>
<code>"1-(2|3)"</code>: Being different from the other four layouts, this is a two-column layout. Original heatmap is in a single column. Sub-heatmap and output are vertically aligned and the two are in the second column. An example can be found at <code><a href="../reference/htShinyExample.html">htShinyExample(4.1)</a></code>.</li>
</ul>
<p>Note the values for <code>layout</code> are in a special format to help to understand the layout, where the three code <code>1</code>, <code>2</code> and <code>3</code> correspond to original heatmap, sub-heatmap and output respectively, symbol <code>"-"</code> corresponds to horizontal alignment and <code>"|"</code> corresponds to vertical alignment. With different layouts, different default values are assigned to widths and heights of the three components to make sure they are well aligned.</p>
</div>
<div id="action-on-single-heatmap-cells" class="section level3">
<h3 class="hasAnchor">
<a href="#action-on-single-heatmap-cells" class="anchor"></a>Action on single heatmap cells</h3>
<p>By default, to get the information of a single cell in the heatmap, a <code>"click"</code> action is used. In <code><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput()</a></code>, the action can also be set to <code>"hover"</code> or <code>"dblclick"</code>, then hovering or double clicking will trigger the response on the sever side. The example in <code><a href="../reference/htShinyExample.html">htShinyExample(1.9)</a></code> demonstrates usages of these three actions.</p>
</div>
<div id="which-action-to-respond" class="section level3">
<h3 class="hasAnchor">
<a href="#which-action-to-respond" class="anchor"></a>Which action to respond</h3>
<p>The argument <code>response</code> can be set as a vector with values in <code>"click"</code>, <code>"hover"</code>, <code>"dblclick"</code>, <code>"brush"</code> and <code>"brush-output"</code> to only respond to one or multiple events on heatmap. E.g. if <code>response</code> is only set to <code>"click"</code>, there will be no response for the “brush event” in the interactive heatmap, also the sub-heatmap component is removed from the app. Please go to Section <a href="InteractiveComplexHeatmap.html#only-respond-to-one-event">“Only respond to one event”</a> for examples.</p>
<p>A brush on heatmap by default triggers two responses, one in the sub-heatmap and one in the output. If <code>"brush-output"</code> is included in <code>response</code> instead of <code>"brush"</code>, you can still brush on the heatmap, but there is only response in the output, and the sub-heatmap component is removed from the app.</p>
</div>
<div id="separately-specify-the-three-ui-components" class="section level3">
<h3 class="hasAnchor">
<a href="#separately-specify-the-three-ui-components" class="anchor"></a>Separately specify the three UI components</h3>
<p><code><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput()</a></code> contains all three UI components. The three components can be separately specified as three individual functions: <code><a href="../reference/originalHeatmapOutput.html">originalHeatmapOutput()</a></code>, <code><a href="../reference/subHeatmapOutput.html">subHeatmapOutput()</a></code> and <code><a href="../reference/HeatmapInfoOutput.html">HeatmapInfoOutput()</a></code>. This provides flexibility for the UI arrangement, e.g. to integrate with package <strong>shinydashboard</strong> where each UI component is wrapped within an individual box.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">body</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shinydashboard/man/dashboardBody.html">dashboardBody</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidRow</a></span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/pkg/shinydashboard/man/box.html">box</a></span><span class="op">(</span>
            title <span class="op">=</span> <span class="st">"Original heatmap"</span>, width <span class="op">=</span> <span class="fl">4</span>, solidHeader <span class="op">=</span> <span class="cn">TRUE</span>, status <span class="op">=</span> <span class="st">"primary"</span>,
            <span class="fu"><a href="../reference/originalHeatmapOutput.html">originalHeatmapOutput</a></span><span class="op">(</span><span class="st">"ht"</span>, title <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
        <span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/shinydashboard/man/box.html">box</a></span><span class="op">(</span>
            title <span class="op">=</span> <span class="st">"Sub-heatmap"</span>, width <span class="op">=</span> <span class="fl">4</span>, solidHeader <span class="op">=</span> <span class="cn">TRUE</span>, status <span class="op">=</span> <span class="st">"primary"</span>,
            <span class="fu"><a href="../reference/subHeatmapOutput.html">subHeatmapOutput</a></span><span class="op">(</span><span class="st">"ht"</span>, title <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
        <span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/shinydashboard/man/box.html">box</a></span><span class="op">(</span>
            title <span class="op">=</span> <span class="st">"Output"</span>, width <span class="op">=</span> <span class="fl">4</span>, solidHeader <span class="op">=</span> <span class="cn">TRUE</span>, status <span class="op">=</span> <span class="st">"primary"</span>,
            <span class="fu"><a href="../reference/HeatmapInfoOutput.html">HeatmapInfoOutput</a></span><span class="op">(</span><span class="st">"ht"</span>, title <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
        <span class="op">)</span>
    <span class="op">)</span>
<span class="op">)</span>

<span class="va">ui</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shinydashboard/man/dashboardPage.html">dashboardPage</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shinydashboard/man/dashboardHeader.html">dashboardHeader</a></span><span class="op">(</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/shinydashboard/man/dashboardSidebar.html">dashboardSidebar</a></span><span class="op">(</span><span class="op">)</span>,
    <span class="va">body</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap</a></span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span>, <span class="va">ht</span>, <span class="st">"ht"</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<script>
document.write('<img src="https://jokergoo.github.io/images/shinydashboard.png" width="100%" />');
</script><p>Please note, since now the three components are generated independently, to correctly connect the three components as well as the server side, the heatmap ID must be explicitely specified in all functions. More examples on integrating with <strong>shinydashboard</strong> can be found from <code><a href="../reference/htShinyExample.html">htShinyExample(10.1)</a></code> to <code><a href="../reference/htShinyExample.html">htShinyExample(10.5)</a></code>. In vignette <a href="deseq2_app.html">“A Shiny app for visualizing DESeq2 results”</a>, we demonstrate a complex app where the three UI components are specified separately to work with <strong>shinydashboard</strong>.</p>
</div>
</div>
<div id="work-with-r-markdown-documents" class="section level2">
<h2 class="hasAnchor">
<a href="#work-with-r-markdown-documents" class="anchor"></a>Work with R Markdown documents</h2>
<p>It is very straightforward to integrate <strong>InteractiveComplexHeatmap</strong> in an interactive R Markdown document, just in the same way of integrating normal Shiny widgets. Following is an example and you can run a real interactive document with heatmaps by <code><a href="../reference/htShinyExample.html">htShinyExample(7.1)</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "InteractiveComplexHeatmap in an Rmarkdown document"</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Zuguang Gu"</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "16/12/2020"</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> html_document</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="an">runtime:</span><span class="co"> shiny</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = FALSE}</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="in">library(InteractiveComplexHeatmap)</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="in">m = matrix(rnorm(100*100), 100)</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="in">ht = Heatmap(m)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = FALSE}</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="in">ui = fluidPage(</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="in">    InteractiveComplexHeatmapOutput()</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="in">server = function(input, output, session) {</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="in">    makeInteractiveComplexHeatmap(input, output, session, ht)</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="in">shiny::shinyApp(ui, server)</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<script>
document.write('<img src="https://jokergoo.github.io/images/rmarkdown.png" width="100%" />');
</script>
</div>
<div id="self-define-the-output" class="section level2">
<h2 class="hasAnchor">
<a href="#self-define-the-output" class="anchor"></a>Self-define the output</h2>
<p>Both the click and brush actions on the heatmap trigger an output below the heatmaps. The output gives the information of which row(s) and columns(s) are selected by users. The reponse for the two actions can be self-defined.</p>
<p>In <code><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap()</a></code>, there are two arguments <code>click_action</code> and <code>brush_action</code> which accept self-defined functions and define how to respond after the heatmap is clicked or brushed. The input for the two functions should accept two arguments, one is a <code>DataFrame</code> object which contains the information of which row(s) and columns(s) selected by users, and the second argument should always be <code>output</code> which is used in the Shiny app. <code>click_action</code> and <code>brush_action</code> can also be functions with four arguments which also includes <code>input</code> and <code>session</code>, in a form of <code>function(df, input, output, session) {...}</code>.</p>
<p>To use <code>click_action</code> or <code>brush_action</code>, a <code>htmlOutput</code> (or other similar <code>*Output</code>) should be first set up in the UI, then the Shiny application knows where to update the output. The output UI can replace the default output by directly assigning to argument <code>output_ui</code> in <code><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput</a></span><span class="op">(</span>output_ui <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">htmlOutput</a></span><span class="op">(</span><span class="st">"info"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Or to create a new output UI independent to the interactive heatmap widget:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput</a></span><span class="op">(</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">htmlOutput</a></span><span class="op">(</span><span class="st">"info"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>The <code>click_action</code> or <code>brush_action</code> is basically defined as follows (assume the ID set in <code><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">htmlOutput()</a></code> is <code>"info"</code>):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">output</span><span class="op">[[</span><span class="st">"info"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI</a></span><span class="op">(</span><span class="op">{</span>  <span class="co"># or output$info = ...</span>
        <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co"># have not clicked or brushed into the heatmap body</span>
            <span class="va">...</span>
        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
            <span class="va">...</span>
        <span class="op">}</span>
    <span class="op">}</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>If users didn’t click or brush inside the heatmap body (e.g. clicked in the dendrograms), <code>df</code> that is passed to the functions will be <code>NULL</code>. Users might need to perform a sanity check here and print specific output when the heatmap was not selected.</p>
<p>The format of <code>df</code> is slightly different between click and brush. If it is a click action, <code>df</code> has the same format as the returned object of <code><a href="../reference/selectPosition.html">selectPosition()</a></code> function, which looks like follows. It always has one row.</p>
<pre><code>## DataFrame with 1 row and 6 columns
##       heatmap                  slice row_slice column_slice row_index
##   &lt;character&gt;            &lt;character&gt; &lt;numeric&gt;    &lt;numeric&gt; &lt;integer&gt;
## 1       mat_a mat_a_heatmap_body_1_2         1            2         9
##   column_index
##      &lt;integer&gt;
## 1            1</code></pre>
<p>If it is a brush action, <code>df</code> has the same format as the returned object of <code><a href="../reference/selectArea.html">selectArea()</a></code> function, which looks like in the following chunk. Each line contains row and column indices of the selected sub-matrix in a specific heatmap slice of a specific heatmap.</p>
<pre><code>## DataFrame with 4 rows and 6 columns
##       heatmap                  slice row_slice column_slice     row_index
##   &lt;character&gt;            &lt;character&gt; &lt;numeric&gt;    &lt;numeric&gt; &lt;IntegerList&gt;
## 1       mat_a mat_a_heatmap_body_1_2         1            2     7,5,2,...
## 2       mat_a mat_a_heatmap_body_2_2         2            2           6,3
## 3       mat_b mat_b_heatmap_body_1_1         1            1     7,5,2,...
## 4       mat_b mat_b_heatmap_body_2_1         2            1           6,3
##    column_index
##   &lt;IntegerList&gt;
## 1     2,4,1,...
## 2     2,4,1,...
## 3     1,2,3,...
## 4     1,2,3,...</code></pre>
<p>Note as demonstrated above, the values in column <code>row_index</code> and <code>column_index</code> might be duplicated due to that the selected heatmap slices are in a same row slice or column slice, <em>e.g.</em>, in previous example, the first and the third rows correspond to selection in the first row slice, but in the two column slices respectively, so they have the same value for <code>row_index</code>. thus, to safely get the row indices and column indices of the selected heatmap, users might need to perform:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">row_index</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">column_index</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Note again, if users want to use the values in <code>input</code> or <code>session</code>, <code>click_action</code> and <code>brush_action</code> can also be specified as functions with four arguments:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">output</span><span class="op">[[</span><span class="st">"info"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI</a></span><span class="op">(</span><span class="op">{</span>  <span class="co"># or output$info = ...</span>
        <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co"># have not clicked into the heatmap body</span>
            <span class="va">...</span>
        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
            <span class="va">...</span>
        <span class="op">}</span>
    <span class="op">}</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>If <code>action</code> in <code><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput()</a></code> is set to <code>"hover"</code> or <code>"dblclick"</code>, the corresponding argument for action is <code>hover_action</code> or <code>dblclick_action</code>. The usage is exactly the same as <code>click_action</code>.</p>
<div id="examples-of-self-defining-output" class="section level3">
<h3 class="hasAnchor">
<a href="#examples-of-self-defining-output" class="anchor"></a>Examples of self-defining output</h3>
<p>In this section, I will demonstrate several examples of implementing self-defined output.</p>
<p>In the first example, I replace the default ui with a new <code><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">htmlOutput("info")</a></code>. On the sever side, I define a <code>click_action</code> to print a styled text and a <code>brush_action</code> to print the table of the selected rows and columns from the heatmap. This following example can be run by <code><a href="../reference/htShinyExample.html">htShinyExample(5.2)</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/GetoptLong">GetoptLong</a></span><span class="op">)</span>  <span class="co"># for the qq() function which does variable intepolation</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">rand_mat</span><span class="op">)</span>
<span class="va">ht</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">rand_mat</span>, show_row_names <span class="op">=</span> <span class="cn">FALSE</span>, show_column_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">ht</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html">draw</a></span><span class="op">(</span><span class="va">ht</span><span class="op">)</span>

<span class="va">ui</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput</a></span><span class="op">(</span>output_ui <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">htmlOutput</a></span><span class="op">(</span><span class="st">"info"</span><span class="op">)</span><span class="op">)</span>,
<span class="op">)</span>

<span class="va">click_action</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">output</span><span class="op">[[</span><span class="st">"info"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI</a></span><span class="op">(</span><span class="op">{</span>
        <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
            <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/HTML.html">HTML</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/GetoptLong/man/qq.html">qq</a></span><span class="op">(</span><span class="st">"&lt;p style='background-color:#FF8080;color:white;padding:5px;'&gt;You have clicked on heatmap @{df$heatmap}, row @{df$row_index}, column @{df$column_index}&lt;/p&gt;"</span><span class="op">)</span><span class="op">)</span>
        <span class="op">}</span>
    <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span><span class="op">)</span>
<span class="va">brush_action</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">row_index</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">row_index</span><span class="op">)</span><span class="op">)</span>
    <span class="va">column_index</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">column_index</span><span class="op">)</span><span class="op">)</span>
    <span class="va">output</span><span class="op">[[</span><span class="st">"info"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI</a></span><span class="op">(</span><span class="op">{</span>
        <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
            <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/HTML.html">HTML</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html">kbl</a></span><span class="op">(</span><span class="va">m</span><span class="op">[</span><span class="va">row_index</span>, <span class="va">column_index</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>, digits <span class="op">=</span> <span class="fl">2</span>, format <span class="op">=</span> <span class="st">"html"</span><span class="op">)</span>, full_width <span class="op">=</span> <span class="cn">FALSE</span>, position <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span><span class="op">)</span>
        <span class="op">}</span>
    <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">server</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap</a></span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span>, <span class="va">ht</span>,
        click_action <span class="op">=</span> <span class="va">click_action</span>, brush_action <span class="op">=</span> <span class="va">brush_action</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<script>
document.write('<img src="https://jokergoo.github.io/images/customize_output.gif" width="100%" />');
</script><p>The second example gives another scenario where the output needs to be self-defined. In this example, an gene expression matrix is visualized and clicking on the heatmap will print the corresponding gene and some other annotations related to this gene (e.g. the corresponding gene symbol, RefSeq IDs and UniProt IDs). Run <code><a href="../reference/htShinyExample.html">htShinyExample(5.3)</a></code> to see how this is implemented.</p>
<script>
document.write('<img src="https://jokergoo.github.io/images/customize_output2.png" width="100%" />');
</script><p><code><a href="../reference/htShinyExample.html">htShinyExample(5.4)</a></code> gives an example where the heatmap visualizes correlations of a list of Gene Ontology terms (The plot is generated by <a href="https://bioconductor.org/packages/simplifyEnrichment/">the <strong>simplifyEnrichment</strong> package</a>). In this example, the click and brush actions are self-defined so that the selected GO IDs as well as their detailed descriptions are printed.</p>
<script>
document.write('<img src="https://jokergoo.github.io/images/customize_output3.png" width="100%" />');
</script><p><code><a href="../reference/htShinyExample.html">htShinyExample(5.5)</a></code> visualizes an correlation heatmap where clicking on the cell generates a scatter plot of the two corresponding variables. In this example, I set <code>response = "click"</code> in <code><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput()</a></code>, so that the sub-heatmap is removed from the app and the scatterplot (the output) is directly placed on the right of the original correlation heatmap.</p>
<script>
document.write('<img src="https://jokergoo.github.io/images/corrheatmap.gif" width="100%" />');
</script><p><code><a href="../reference/htShinyExample.html">htShinyExample(5.6)</a></code> visualizes an a heatmap of pairwise Jaccard coefficients for multiple lists of genomic regions. Clicking on the heatmap cell draws a Hilbert curve (draw by <a href="https://bioconductor.org/packages/HilbertCurve/">the <strong>HilbertCurve</strong> package</a>) which shows how the two corresponding sets of genomic regions overlap.</p>
<script>
document.write('<img src="https://jokergoo.github.io/images/hilbert_curve.gif" width="100%" />');
</script><p>Instead of occupying static space, the output component can be floated to the mouse positions by setting <code>output_ui_float = TRUE</code> in <code><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput()</a></code> so that clicking, hovering or brushing from the heatmap opens a frame that contains the output. There are two examples: <code><a href="../reference/htShinyExample.html">htShinyExample(9.1)</a></code> and <code><a href="../reference/htShinyExample.html">htShinyExample(9.2)</a></code>. The demonstration is as follows:</p>
<script>
document.write('<img src="https://jokergoo.github.io/images/float1.gif" width="100%" />');
</script><p>The self-defined output can also be floated if the self-defined UI replaces the default UI by setting <code><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput(..., output_ui = new_output_ui)</a></code>:</p>
<script>
document.write('<img src="https://jokergoo.github.io/images/float2.gif" width="100%" />');
</script>
</div>
</div>
<div id="compact-mode" class="section level2">
<h2 class="hasAnchor">
<a href="#compact-mode" class="anchor"></a>Compact mode</h2>
<p>In <code><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput()</a></code>, argument <code>compact</code> can be set to <code>TRUE</code>, so there is only the original heatmap and the output is floating at the mouse positions if hovering/clicking on heatmap. The calling</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput</a></span><span class="op">(</span><span class="va">...</span>, compact <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>is actually identical to</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">InteractiveComplexHeatmap</span><span class="op">(</span><span class="va">...</span>, response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">action</span>, <span class="st">"brush-output"</span><span class="op">)</span>, output_ui_float <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Self-defined output can still be used here, e.g.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_output_ui</span> <span class="op">=</span> <span class="va">...</span>
<span class="fu">InteractiveComplexHeatmap</span><span class="op">(</span><span class="va">...</span>, compact <span class="op">=</span> <span class="cn">TRUE</span>, output_ui <span class="op">=</span> <span class="va">new_output_ui</span><span class="op">)</span></code></pre></div>
<p>See examples with <code><a href="../reference/htShinyExample.html">htShinyExample(1.11)</a></code>.</p>
</div>
<div id="dynamically-generate-interactive-heatmap-widget" class="section level2">
<h2 class="hasAnchor">
<a href="#dynamically-generate-interactive-heatmap-widget" class="anchor"></a>Dynamically generate interactive heatmap widget</h2>
<p>In previous examples, the heatmaps are already generated before making the interactive app. There are also scenarios where the heatmaps are generated on the fly, e.g. when the matrix is dynamically generated in the middle of an analysis. There might be following scenarios:</p>
<ul>
<li>The heatmap is based on a subset of matrix which is filtered by users, <em>e.g.</em>, the expression matrix for differentially expressed genes filtered by different cutoffs.</li>
<li>The annotations are dynamically provided by users.</li>
<li>The heatmap parameters are changed by users, <em>e.g.</em>, the clustering method or the splitting variable.</li>
<li>If there are multiple heatmaps, which heatmaps are going to be drawn is dynamically selected.</li>
</ul>
<p>In <strong>InteractiveComplexHeatmap</strong>, there are three ways to dynamically generate the interactive heatmap widgets which I will explain one by one.</p>
<div id="directly-use-makeinteractivecomplexheatmap" class="section level3">
<h3 class="hasAnchor">
<a href="#directly-use-makeinteractivecomplexheatmap" class="anchor"></a>Directly use <code>makeInteractiveComplexHeatmap()</code>
</h3>
<p>I first demonstrate use of <code><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap()</a></code>. In the following example, the matrix is reordered by a user-selected column:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op">(</span><span class="st">"column"</span>, label <span class="op">=</span> <span class="st">"Which column to order?"</span>, 
        value <span class="op">=</span> <span class="fl">1</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
    <span class="fu"><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/pkg/cola/man/rownames-dispatch.html">rownames</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>
    <span class="fu"><a href="https://rdrr.io/pkg/cola/man/colnames-dispatch.html">colnames</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>

    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">column</span>, <span class="op">{</span>
        <span class="va">order</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">m</span><span class="op">[</span>, <span class="va">input</span><span class="op">$</span><span class="va">column</span><span class="op">]</span><span class="op">)</span>
        <span class="va">ht</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">m</span><span class="op">[</span><span class="va">order</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>, 
            cluster_rows <span class="op">=</span> <span class="cn">FALSE</span>, cluster_columns <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
        <span class="fu"><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap</a></span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span>, <span class="va">ht</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>A similar but slightly complex example is as follows. It can be run by <code><a href="../reference/htShinyExample.html">htShinyExample(6.2)</a></code>.</p>
<script>
document.write('<img src="https://jokergoo.github.io/images/dynamic_widget4.gif" width="100%" />');
</script><p>The use is very natural. <code><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap()</a></code> is put inside an <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent()</a></code> or an <code><a href="https://rdrr.io/pkg/shiny/man/observe.html">observe()</a></code> so that every time <code>input$column</code> changes, it triggers an update of the interactive heatmap widgets.</p>
<p>In the following code block defined in <code>server</code> function:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="va">...</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">column</span>, <span class="op">{</span>
        <span class="va">order</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">m</span><span class="op">[</span>, <span class="va">input</span><span class="op">$</span><span class="va">column</span><span class="op">]</span><span class="op">)</span>
        <span class="va">ht</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">m</span><span class="op">[</span><span class="va">order</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>, 
            cluster_rows <span class="op">=</span> <span class="cn">FALSE</span>, cluster_columns <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
        <span class="fu"><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap</a></span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span>, <span class="va">ht</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
    <span class="va">...</span></code></pre></div>
<p><code><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap()</a></code> internally creates a list of responses by <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent()</a></code>. Every time when <code>input$column</code> triggers the update of <code><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap()</a></code>, all the calls of <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent()</a></code> will be re-executed. Re-executing <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent()</a></code> only adds the observations to the current observation list while not overwrites them, thus, repeatedly executing <code><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap()</a></code> will make a same observatin running multiple times. To solve this issue, <code><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap()</a></code> saves all the observations returned by <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent()</a></code> and it tries to first destroies all the avaiable observations that have been created. However, if user-defined reponses via <code>click_action</code> and <code>brush_action</code> use <code><a href="https://rdrr.io/pkg/shiny/man/observe.html">observe()</a></code> or <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent()</a></code>, they must manually recorded so that they can also be destroied when updating <code><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap()</a></code>. See the following example:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">click_action</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">obs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">foo</span>, <span class="op">{</span>
        <span class="va">...</span>
    <span class="op">}</span><span class="op">)</span>
    <span class="fu"><a href="../reference/record_observation.html">record_observation</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="use-interactivecomplexheatmapmodal-and-interactivecomplexheatmapwidget" class="section level3">
<h3 class="hasAnchor">
<a href="#use-interactivecomplexheatmapmodal-and-interactivecomplexheatmapwidget" class="anchor"></a>Use <code>InteractiveComplexHeatmapModal()</code> and <code>InteractiveComplexHeatmapWidget()</code>
</h3>
<p>In the first example, the interactive heatmap is already generated when the Shiny app is loaded. There is a second scenario where the complete interactive heatmap widget is dynamically generated and inserted into the HTML document. There are two other functions <code><a href="../reference/InteractiveComplexHeatmapModal.html">InteractiveComplexHeatmapModal()</a></code> and <code><a href="../reference/InteractiveComplexHeatmapWidget.html">InteractiveComplexHeatmapWidget()</a></code> which have very similar behaviors. These two functions are normally put inside e.g. <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">shiny::observeEvent()</a></code> or <code><a href="https://rdrr.io/pkg/shiny/man/observe.html">shiny::observe()</a></code> and they generate UI as well as render the interactive heatmaps.</p>
<p>First I will introduce the usage of <code><a href="../reference/InteractiveComplexHeatmapModal.html">InteractiveComplexHeatmapModal()</a></code>. In the following example, there is only an action button in the UI, and in the server function, <code><a href="../reference/InteractiveComplexHeatmapModal.html">InteractiveComplexHeatmapModal()</a></code> is called when receiving an <code>input$show_heatmap</code> signal. This example can also be run by <code><a href="../reference/htShinyExample.html">htShinyExample(6.3)</a></code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span><span class="st">"show_heatmap"</span>, <span class="st">"Generate_heatmap"</span><span class="op">)</span>,
<span class="op">)</span>

<span class="va">server</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>
    <span class="va">ht</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>

    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">show_heatmap</span>, <span class="op">{</span>
        <span class="fu"><a href="../reference/InteractiveComplexHeatmapModal.html">InteractiveComplexHeatmapModal</a></span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span>, <span class="va">ht</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>As shown in the following figure, <code><a href="../reference/InteractiveComplexHeatmapModal.html">InteractiveComplexHeatmapModal()</a></code> will open an “modal frame” which includes the interactive heatmap.</p>
<script>
document.write('<img src="https://jokergoo.github.io/images/dynamic_widget.gif" width="100%" />');
</script><p>In the next example which is also available in <code><a href="../reference/htShinyExample.html">htShinyExample(6.4)</a></code>, a different heatmap is generated according to user’s selection.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/radioButtons.html">radioButtons</a></span><span class="op">(</span><span class="st">"select"</span>, <span class="st">"Select"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Numeric"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"Character"</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span><span class="st">"show_heatmap"</span>, <span class="st">"Generate_heatmap"</span><span class="op">)</span>,
<span class="op">)</span>

<span class="va">get_heatmap_fun</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">mat_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>
    <span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">mat_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">server</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">show_heatmap</span>, <span class="op">{</span>
        <span class="va">i</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">select</span><span class="op">)</span>
        <span class="fu"><a href="../reference/InteractiveComplexHeatmapModal.html">InteractiveComplexHeatmapModal</a></span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span>, 
            get_heatmap <span class="op">=</span> <span class="fu">get_heatmap_fun</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<script>
document.write('<img src="https://jokergoo.github.io/images/dynamic_widget_radio_selection.gif" width="100%" />');
</script><p>The usage of <code><a href="../reference/InteractiveComplexHeatmapWidget.html">InteractiveComplexHeatmapWidget()</a></code> is very similar as <code><a href="../reference/InteractiveComplexHeatmapModal.html">InteractiveComplexHeatmapModal()</a></code>, except that now for <code><a href="../reference/InteractiveComplexHeatmapWidget.html">InteractiveComplexHeatmapWidget()</a></code>, user needs to allocate a place defined by <code><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">shiny::htmlOutput()</a></code> in UI, and later the interactive heatmap widget is put there.</p>
<p>I modify the previous example with <code><a href="../reference/InteractiveComplexHeatmapWidget.html">InteractiveComplexHeatmapWidget()</a></code>. Now in the UI, I add one line where I specify <code><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">htmlOutput()</a></code> with ID <code>"heatmap_output"</code>, and this ID is set in <code><a href="../reference/InteractiveComplexHeatmapWidget.html">InteractiveComplexHeatmapWidget()</a></code> correspondingly.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span><span class="st">"show_heatmap"</span>, <span class="st">"Generate_heatmap"</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">htmlOutput</a></span><span class="op">(</span><span class="st">"heatmap_output"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>
    <span class="va">ht</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>
    
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">show_heatmap</span>, <span class="op">{</span>
        <span class="fu"><a href="../reference/InteractiveComplexHeatmapWidget.html">InteractiveComplexHeatmapWidget</a></span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span>, <span class="va">ht</span>, output_id <span class="op">=</span> <span class="st">"heatmap_output"</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>The app looks like follows:</p>
<script>
document.write('<img src="https://jokergoo.github.io/images/dynamic_widget2.gif" width="100%" />');
</script><p><code><a href="../reference/InteractiveComplexHeatmapModal.html">InteractiveComplexHeatmapModal()</a></code> and <code><a href="../reference/InteractiveComplexHeatmapWidget.html">InteractiveComplexHeatmapWidget()</a></code> all accept an argument <code>js_code</code> where customized JavaScript code can be inserted after the interactive UI. This is sometimes useful. In previous example where the heatmap widget is triggered by clicking on the action button, every time when clicking on the button, the widget is regenerated although the heatmaps are actually the same. Actually we can change the behavior of the button that from the second click it just switches the visibility of the heatmap widget. See more examples in <code><a href="../reference/htShinyExample.html">htShinyExample(6.5)</a></code> and <code><a href="../reference/htShinyExample.html">htShinyExample(6.7)</a></code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span><span class="st">"show_heatmap"</span>, <span class="st">"Generate_heatmap"</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">htmlOutput</a></span><span class="op">(</span><span class="st">"heatmap_output"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>
    <span class="va">ht</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>
    
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">show_heatmap1</span>, <span class="op">{</span>
        <span class="fu"><a href="../reference/InteractiveComplexHeatmapWidget.html">InteractiveComplexHeatmapWidget</a></span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span>, <span class="va">ht</span>, 
            output_id <span class="op">=</span> <span class="st">"heatmap_output"</span>, close_button <span class="op">=</span> <span class="cn">FALSE</span>,
            
            js_code <span class="op">=</span> <span class="st">"
                $('#show_heatmap').click(function() {
                    $('#heatmap_output').toggle('slow');
                }).text('Show/hide heatmap').
                   attr('id', 'show_heatmap_toggle');
            "</span>
        <span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<script>
document.write('<img src="https://jokergoo.github.io/images/dynamic_widget3.gif" width="100%" />');
</script>
</div>
</div>
<div id="implement-interactivity-from-scratch" class="section level2">
<h2 class="hasAnchor">
<a href="#implement-interactivity-from-scratch" class="anchor"></a>Implement interactivity from scratch</h2>
<p><strong>InteractiveComplexHeatmap</strong> provides rich tools for interactively working with heatmaps. However, some people might want to develop their own tools while they only need the information of which cells are selected. Next I demonstrate it with a simple example. The following example is runnable.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span><span class="st">"action"</span>, <span class="st">"Generate heatmap"</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"heatmap"</span>, width <span class="op">=</span> <span class="fl">500</span>, height <span class="op">=</span> <span class="fl">500</span>, click <span class="op">=</span> <span class="st">"heatmap_click"</span>, 
        brush <span class="op">=</span> <span class="st">"heatmap_brush"</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">verbatimTextOutput</a></span><span class="op">(</span><span class="st">"output"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">server</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>

    <span class="va">ht_obj</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactiveVal.html">reactiveVal</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span>
    <span class="va">ht_pos_obj</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactiveVal.html">reactiveVal</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span>

    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">action</span>, <span class="op">{</span>
        <span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>
        <span class="fu"><a href="https://rdrr.io/pkg/cola/man/rownames-dispatch.html">rownames</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>
        <span class="fu"><a href="https://rdrr.io/pkg/cola/man/colnames-dispatch.html">colnames</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>

        <span class="va">output</span><span class="op">$</span><span class="va">heatmap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span><span class="op">{</span>
            <span class="va">ht</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html">draw</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span>
            <span class="va">ht_pos</span> <span class="op">=</span> <span class="fu"><a href="../reference/htPositionsOnDevice.html">htPositionsOnDevice</a></span><span class="op">(</span><span class="va">ht</span><span class="op">)</span>

            <span class="fu">ht_obj</span><span class="op">(</span><span class="va">ht</span><span class="op">)</span>
            <span class="fu">ht_pos_obj</span><span class="op">(</span><span class="va">ht_pos</span><span class="op">)</span>
        <span class="op">}</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>

    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">heatmap_click</span>, <span class="op">{</span>
        <span class="va">pos</span> <span class="op">=</span> <span class="fu"><a href="../reference/getPositionFromClick.html">getPositionFromClick</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">heatmap_click</span><span class="op">)</span>

        <span class="va">selection</span> <span class="op">=</span> <span class="fu"><a href="../reference/selectPosition.html">selectPosition</a></span><span class="op">(</span><span class="fu">ht_obj</span><span class="op">(</span><span class="op">)</span>, <span class="va">pos</span>, mark <span class="op">=</span> <span class="cn">FALSE</span>, ht_pos <span class="op">=</span> <span class="fu">ht_pos_obj</span><span class="op">(</span><span class="op">)</span>, 
            verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
        <span class="va">output</span><span class="op">$</span><span class="va">output</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderPrint</a></span><span class="op">(</span><span class="op">{</span>
            <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">selection</span><span class="op">)</span>
        <span class="op">}</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>

    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">heatmap_brush</span>, <span class="op">{</span>
        <span class="va">lt</span> <span class="op">=</span> <span class="fu"><a href="../reference/getPositionFromBrush.html">getPositionFromBrush</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">heatmap_brush</span><span class="op">)</span>

        <span class="va">selection</span> <span class="op">=</span> <span class="fu"><a href="../reference/selectArea.html">selectArea</a></span><span class="op">(</span><span class="fu">ht_obj</span><span class="op">(</span><span class="op">)</span>, <span class="va">lt</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">lt</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, mark <span class="op">=</span> <span class="cn">FALSE</span>, ht_pos <span class="op">=</span> <span class="fu">ht_pos_obj</span><span class="op">(</span><span class="op">)</span>, 
            verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
        <span class="va">output</span><span class="op">$</span><span class="va">output</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderPrint</a></span><span class="op">(</span><span class="op">{</span>
            <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">selection</span><span class="op">)</span>
        <span class="op">}</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>In this simple Shiny app, a click or a brush on heatmap prints the corresponding data frame that contains the information of the selected cells.</p>
<p>There are several points that need to be noticed:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html">draw()</a></code> and <code><a href="../reference/htPositionsOnDevice.html">htPositionsOnDevice()</a></code> need to be put inside the <code><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot()</a></code>.</li>
<li>To get the position of the click on heatmap, <code><a href="../reference/getPositionFromClick.html">getPositionFromClick()</a></code> should be used. With knowing the position of the click, it can be sent to <code><a href="../reference/selectPosition.html">selectPosition()</a></code> to correspond to the original matrix.</li>
<li>Similarly, to get the positions of the area that was brushed on heatmap, <code><a href="../reference/getPositionFromBrush.html">getPositionFromBrush()</a></code> should be used.</li>
</ol>
<p>This method also works for complex heatmaps, e.g. with row or column splitting, or with multiple heatmaps.</p>
<p><br><br><br><br><br></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Zuguang Gu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
